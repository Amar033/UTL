<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Previous head content remains the same -->
    
    <!-- Add Bluetooth permission meta tag -->
    <meta name="bluetooth" content="{"permissions": ["bluetooth"]}">
</head>
<body>
    <div id="root"></div>
    <!-- Loading indicator remains the same -->
    
    <!-- Bluetooth Status Indicator -->
    <div id="bluetooth-status" class="fixed top-4 right-4 flex items-center space-x-2 bg-white rounded-lg shadow-md p-2">
        <div id="bluetooth-indicator" class="w-3 h-3 rounded-full bg-red-500"></div>
        <span id="bluetooth-text" class="text-sm font-medium">Disconnected</span>
    </div>

    <!-- Bluetooth Connection Modal -->
    <div id="bluetooth-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 max-w-sm w-full mx-4">
            <h2 class="text-xl font-bold mb-4">Connect Bluetooth Device</h2>
            <p class="text-gray-600 mb-4">Click the button below to connect to your Bluetooth module.</p>
            <div class="flex justify-end space-x-3">
                <button id="cancel-bluetooth" class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg">
                    Cancel
                </button>
                <button id="connect-bluetooth" class="px-4 py-2 bg-[#1D7469] text-white rounded-lg hover:bg-[#165E55]">
                    Connect
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module">
        import BluetoothHandler from './bluetooth-handler.js';
        
        const bluetoothHandler = new BluetoothHandler();
        const connectButton = document.getElementById('connect-bluetooth');
        const cancelButton = document.getElementById('cancel-bluetooth');
        const bluetoothModal = document.getElementById('bluetooth-modal');
        const bluetoothIndicator = document.getElementById('bluetooth-indicator');
        const bluetoothText = document.getElementById('bluetooth-text');

        // Show connection modal
        function showBluetoothModal() {
            bluetoothModal.classList.remove('hidden');
        }

        // Hide connection modal
        function hideBluetoothModal() {
            bluetoothModal.classList.add('hidden');
        }

        // Update status indicator
        function updateBluetoothStatus(connected) {
            bluetoothIndicator.className = `w-3 h-3 rounded-full ${connected ? 'bg-green-500' : 'bg-red-500'}`;
            bluetoothText.textContent = connected ? 'Connected' : 'Disconnected';
        }

        // Connect button handler
        connectButton.addEventListener('click', async () => {
            try {
                await bluetoothHandler.connect();
                updateBluetoothStatus(true);
                hideBluetoothModal();
            } catch (error) {
                alert('Failed to connect to Bluetooth device. Please try again.');
            }
        });

        // Cancel button handler
        cancelButton.addEventListener('click', hideBluetoothModal);

        // Add global function to send translations
        window.sendToBluetoothDevice = async (translatedText) => {
            if (!bluetoothHandler.isConnected) {
                showBluetoothModal();
                return;
            }
            try {
                await bluetoothHandler.sendTranslation(translatedText);
            } catch (error) {
                alert('Failed to send translation. Please check your connection.');
                updateBluetoothStatus(false);
            }
        };

        // Previous script content remains the same
    </script>
    
    <!-- App entry point remains the same -->
</body>
</html>